<link rel="import" href="../../bower_components/polymer/polymer.html">

    
<!--

The `nfcmim-bluetooth-service` provides  

@group nfcmim-bluetooth-service Elements
@element nfcmim-bluetooth-service
@demo demo/index.html
-->

<dom-module id="nfcmim-bluetooth-service">

    <style>
        :host {
            display: block;
        }
    </style>
    <template>
        <content></content>
    </template>
</dom-module>

<script>
    (function () {
        'use strict';

        Polymer({
            is: 'nfcmim-bluetooth-service',

            properties: {
                uuid: {
                    type: String,
                    notify: true,
                    value: '1105'
                },
                socketId: {
                    type: Number,
                    notify: true
                }
            },


            // --- Accepting client connections
            // --- ---------------------

            _acceptConnection: function () {
                var that = this;
                chrome.bluetoothSocket.create(function(createInfo) {
                    var onListenCallback = function () {

                    };
                    that.serverSocketId = createInfo.socketId;
                    chrome.bluetoothSocket.listenUsingRfcomm(createInfo.socketId,
                            that.uuid, onListenCallback);
                });


                var onReceive = that.receiveMessage.bind(that);
                chrome.bluetoothSocket.onAccept.addListener(function(acceptInfo) {
                    if (info.socketId != serverSocketId)
                        return;

                    // Say hello...
                    chrome.bluetoothSocket.send(acceptInfo.clientSocketId,
                            data, onSendCallback);

                    // Accepted sockets are initially paused,
                    // set the onReceive listener first.
                    chrome.bluetoothSocket.onReceive.addListener(onReceive);
                    chrome.bluetoothSocket.setPaused(false);
                });
            },

            // --- Receiver
            // --- ---------------------

            receiveMessage: function (receiveInfo) {
                if (receiveInfo.socketId != this.socketId) {
                    return;
                }
                console.log('receive message', receiveInfo.data);
                this.fire('message', receiveInfo.data);
                // receiveInfo.data is an ArrayBuffer.
            },

            receiveError: function (errorInfo) {
                // Cause is in errorInfo.error.
                console.log(errorInfo.errorMessage);
            },


        });
    })();
</script>